window.butterbean=window.butterbean||{},function(){function e(){_.each(butterbean_data.managers,function(e){var n=new a(e),i=new t.managers.default({model:n});document.getElementById("butterbean-ui-"+n.get("name")).className+=" butterbean-ui",document.querySelector("#butterbean-ui-"+n.get("name")+" .inside").appendChild(i.render().el),i.subview_render()})}if(!_.isUndefined(butterbean_data)){var t=butterbean={managers:{},sections:{},controls:{}},n={managers:{},sections:{},controls:{}},i=wp.template("butterbean-nav"),a=Backbone.Model.extend({defaults:{name:"",type:"",sections:{},controls:{}}}),o=Backbone.Model.extend({defaults:{name:"",type:"",label:"",description:"",icon:"",manager:"",active:"",selected:!1}}),s=Backbone.Model.extend({defaults:{name:"",type:"",label:"",description:"",icon:"",value:"",choices:{},attr:"",active:"",manager:"",section:"",setting:""}}),r=Backbone.Collection.extend({model:o});t.managers.default=Backbone.View.extend({tagName:"div",attributes:function(){return{id:"butterbean-manager-"+this.model.get("name"),"class":"butterbean-manager butterbean-manager-"+this.model.get("type")}},initialize:function(){var e=this.model.get("type");_.isUndefined(n.managers[e])&&(n.managers[e]=wp.template("butterbean-manager-"+e)),this.template=n.managers[e]},render:function(){return this.el.innerHTML=this.template(this.model.toJSON()),this},subview_render:function(){var e=new r;return _.each(this.model.get("sections"),function(t){e.add(new o(t))}),e.forEach(function(e,n){var i=new l({model:e});document.querySelector("#butterbean-ui-"+e.get("manager")+" .butterbean-nav").appendChild(i.render().el);var a=_.isUndefined(t.sections[e.type])?t.sections.default:t.sections[e.type],o=new a({model:e});document.querySelector("#butterbean-ui-"+e.get("manager")+" .butterbean-content").appendChild(o.render().el),o.ready(),e.set("selected",0===n)},this),_.each(this.model.get("controls"),function(e){var n=new s(e),i=_.isUndefined(t.controls[e.type])?t.controls.default:t.controls[e.type],a=new i({model:n});document.getElementById("butterbean-"+n.get("manager")+"-section-"+n.get("section")).appendChild(a.render().el),a.ready()}),this}}),t.sections.default=Backbone.View.extend({tagName:"div",attributes:function(){return{id:"butterbean-"+this.model.get("manager")+"-section-"+this.model.get("name"),"class":"butterbean-section butterbean-section-"+this.model.get("type"),"aria-hidden":!this.model.get("selected")}},initialize:function(){this.model.on("change",this.onchange,this);var e=this.model.get("type");_.isUndefined(n.sections[e])&&(n.sections[e]=wp.template("butterbean-section-"+e)),this.template=n.sections[e]},render:function(){return this.model.get("active")&&(this.el.innerHTML=this.template(this.model.toJSON())),this},onchange:function(){this.el.setAttribute("aria-hidden",!this.model.get("selected"))},ready:function(){}});var l=Backbone.View.extend({template:i,tagName:"li",attributes:function(){return{"aria-selected":this.model.get("selected")}},initialize:function(){this.model.on("change",this.render,this),this.model.on("change",this.onchange,this)},render:function(){return this.model.get("active")&&(this.el.innerHTML=this.template(this.model.toJSON())),this},events:{"click a":"onselect"},onchange:function(){this.el.setAttribute("aria-selected",this.model.get("selected"))},onselect:function(e){e.preventDefault(),_.each(this.model.collection.models,function(e){e.set("selected",!1)},this),this.model.set("selected",!0)}});t.controls.default=Backbone.View.extend({tagName:"div",attributes:function(){return{id:"butterbean-control-"+this.model.get("name"),"class":"butterbean-control butterbean-control-"+this.model.get("type")}},initialize:function(){var e=this.model.get("type");_.isUndefined(n.controls[e])&&(n.controls[e]=wp.template("butterbean-control-"+e)),this.template=n.controls[e],_.bindAll(this,"render"),this.model.bind("change",this.render)},render:function(){return this.model.get("active")&&(this.el.innerHTML=this.template(this.model.toJSON())),this},ready:function(){}}),t.controls.palette=t.controls.default.extend({events:{"change input":"onselect"},onselect:function(){var e=document.querySelector("#"+this.el.id+" input:checked").getAttribute("value"),t=this.model.get("choices");_.each(t,function(t,n){t.selected=n===e}),this.model.set("choices",t).trigger("change",this.model)}}),t.controls.image=t.controls.default.extend({events:{"click .butterbean-add-media":"showmodal","click .butterbean-change-media":"showmodal","click .butterbean-remove-media":"removemedia"},showmodal:function(){return _.isUndefined(this.modal)?(this.modal=wp.media({frame:"select",multiple:!1,editing:!0,title:this.model.get("l10n").choose,library:{type:"image"},button:{text:this.model.get("l10n").set}}),this.modal.on("select",function(){var e=this.modal.state().get("selection").first().toJSON();this.model.set({src:e.sizes.large?e.sizes.large.url:e.url,alt:e.alt,value:e.id})},this),this.modal.open(),void 0):(this.modal.open(),void 0)},removemedia:function(){this.model.set({src:"",alt:"",value:""})}}),"undefined"!=typeof document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):"undefined"!=typeof window.attachEvent&&window.attachEvent("onload",e)}}();